<!-- Common Fields -->
<ng-container>
  <!-- Title -->
  <div class="grid grid-cols-3 items-center gap-4 mb-4">
    <label
      for="title"
      class="text-md font-medium text-theme-bodycolor dark:text-themedark-bodycolor"
    >
      {{ 'Field_Title' | localize }}
    </label>
    <div class="col-span-2 relative">
      <input
        type="text"
        name="title"
        id="title"
        required
        [(ngModel)]="issue.title"
        #titleModel="ngModel"
        #titleEl
        class="w-full px-3 py-2 rounded-md border text-theme-bodycolor dark:text-themedark-bodycolor
               bg-theme-inputbg dark:bg-themedark-inputbg transition focus:outline-none focus:ring-1
               focus:ring-primary-500 border-theme-inputborder dark:border-themedark-inputborder
               text-sm"
      />
      <abp-validation-summary
        class="text-red-500 mt-1 text-sm"
        [control]="titleModel"
        [controlEl]="titleEl"
      ></abp-validation-summary>
    </div>
  </div>

  <!-- Description -->
  <div class="grid grid-cols-3 items-center gap-4 mb-4">
    <label
      for="description"
      class="text-md font-medium text-theme-bodycolor dark:text-themedark-bodycolor"
    >
      {{ 'Field_Description' | localize }}
    </label>
    <div class="col-span-2 relative">
      <textarea
        name="description"
        id="description"
        required
        [(ngModel)]="issue.description"
        #descriptionModel="ngModel"
        #descriptionEl
        class="w-full px-3 py-2 rounded-md border text-theme-bodycolor dark:text-themedark-bodycolor
               bg-theme-inputbg dark:bg-themedark-inputbg transition focus:outline-none focus:ring-1
               focus:ring-primary-500 border-theme-inputborder dark:border-themedark-inputborder
               text-sm"
        rows="4"
      ></textarea>
      <abp-validation-summary
        class="text-red-500 mt-1 text-sm"
        [control]="descriptionModel"
        [controlEl]="descriptionEl"
      ></abp-validation-summary>
    </div>
  </div>

  <!-- Client Full Name -->
  <div class="grid grid-cols-3 items-center gap-4 mb-4">
    <label
      for="clientFullName"
      class="text-md font-medium text-theme-bodycolor dark:text-themedark-bodycolor"
    >
      {{ 'ClientFullName' | localize }}
    </label>
    <div class="col-span-2 relative">
      <input
        type="text"
        name="clientFullName"
        id="clientFullName"
        required
        [(ngModel)]="issue.clientFullName"
        #clientFullNameModel="ngModel"
        #clientFullNameEl
        class="w-full px-3 py-2 rounded-md border text-theme-bodycolor dark:text-themedark-bodycolor
               bg-theme-inputbg dark:bg-themedark-inputbg transition focus:outline-none focus:ring-1
               focus:ring-primary-500 border-theme-inputborder dark:border-themedark-inputborder
               text-sm"
      />
      <abp-validation-summary
        class="text-red-500 mt-1 text-sm"
        [control]="clientFullNameModel"
        [controlEl]="clientFullNameEl"
      ></abp-validation-summary>
    </div>
  </div>

  <!-- Gender Dropdown -->
  <div class="grid grid-cols-3 items-center gap-4 mb-4">
    <label
      for="gender"
      class="text-md font-medium text-theme-bodycolor dark:text-themedark-bodycolor"
    >
      {{ 'Gender' | localize }}
    </label>
    <div class="col-span-2 relative dropdown">
      <div
        class="dropdown-toggle w-full px-3 py-2 rounded-md border text-theme-bodycolor dark:text-themedark-bodycolor
               bg-theme-inputbg dark:bg-themedark-inputbg transition focus:outline-none focus:ring-1
               focus:ring-primary-500 border-theme-inputborder dark:border-themedark-inputborder
               text-sm cursor-pointer flex justify-between items-center"
        (click)="toggleGenderDropdown(); $event.stopPropagation()"
      >
        <span>{{ getSelectedGenderDisplay() }}</span>
        <svg
          class="w-4 h-4"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M19 9l-7 7-7-7"
          ></path>
        </svg>
      </div>
      <input
        type="hidden"
        name="gender"
        [(ngModel)]="issue.gender"
        #genderModel="ngModel"
        required
      />
      <abp-validation-summary
        class="text-red-500 mt-1 text-sm"
        [control]="genderModel"
      ></abp-validation-summary>
      <div
        *ngIf="isGenderDropdownOpen"
        class="absolute left-0 top-full mt-1 w-full bg-theme-cardbg dark:bg-themedark-cardbg
               border border-theme-inputborder dark:border-themedark-inputborder rounded-md shadow-lg
               max-h-[50vh] overflow-y-auto scrollbar-thin scrollbar-thumb-primary-500
               scrollbar-track-theme-inputbg dark:scrollbar-track-themedark-inputbg z-[1000]"
      >
        <input
          type="text"
          [(ngModel)]="genderSearch"
          (ngModelChange)="filterGenders()"
          (click)="stopPropagation($event)"
          placeholder="{{ 'Search' | localize }}"
          class="w-full px-3 py-2 border-b text-theme-bodycolor dark:text-themedark-bodycolor
                 bg-theme-inputbg dark:bg-themedark-inputbg border-theme-inputborder
                 dark:border-themedark-inputborder text-sm focus:outline-none"
        />
        <div
          *ngFor="let gender of filteredGenderOptions"
          class="px-3 py-2 text-sm text-theme-bodycolor dark:text-themedark-bodycolor
                 hover:bg-primary-100 dark:hover:bg-primary-900 cursor-pointer"
          (click)="selectGender(gender); $event.stopPropagation()"
        >
          {{ gender.display }}
        </div>
        <div
          *ngIf="!filteredGenderOptions.length"
          class="px-3 py-2 text-sm text-theme-bodycolor dark:text-themedark-bodycolor"
        >
          {{ 'NoGendersAvailable' | localize }}
        </div>
      </div>
    </div>
  </div>

  <!-- Priority Dropdown -->
  <div class="grid grid-cols-3 items-center gap-4 mb-4">
    <label
      for="priority"
      class="text-md font-medium text-theme-bodycolor dark:text-themedark-bodycolor"
    >
      {{ 'Field_Priority' | localize }}
    </label>
    <div class="col-span-2 relative dropdown">
      <div
        class="dropdown-toggle w-full px-3 py-2 rounded-md border text-theme-bodycolor dark:text-themedark-bodycolor
               bg-theme-inputbg dark:bg-themedark-inputbg transition focus:outline-none focus:ring-1
               focus:ring-primary-500 border-theme-inputborder dark:border-themedark-inputborder
               text-sm cursor-pointer flex justify-between items-center"
        (click)="togglePriorityDropdown(); $event.stopPropagation()"
      >
        <span>{{ selectedPriority?.title || ('SelectPriority' | localize) }}</span>
        <svg
          class="w-4 h-4"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M19 9l-7 7-7-7"
          ></path>
        </svg>
      </div>
      <input
        type="hidden"
        name="priorityId"
        [(ngModel)]="issue.priorityId"
        #priorityIdModel="ngModel"
        required
      />
      <abp-validation-summary
        class="text-red-500 mt-1 text-sm"
        [control]="priorityIdModel"
      ></abp-validation-summary>
      <div
        *ngIf="isPriorityDropdownOpen"
        class="absolute left-0 top-full mt-1 w-full bg-theme-cardbg dark:bg-themedark-cardbg
               border border-theme-inputborder dark:border-themedark-inputborder rounded-md shadow-lg
               max-h-[50vh] overflow-y-auto scrollbar-thin scrollbar-thumb-primary-500
               scrollbar-track-theme-inputbg dark:scrollbar-track-themedark-inputbg z-[1000]"
      >
        <input
          type="text"
          [(ngModel)]="prioritySearch"
          (ngModelChange)="filterPriorities()"
          (click)="stopPropagation($event)"
          placeholder="{{ 'Search' | localize }}"
          class="w-full px-3 py-2 border-b text-theme-bodycolor dark:text-themedark-bodycolor
                 bg-theme-inputbg dark:bg-themedark-inputbg border-theme-inputborder
                 dark:border-themedark-inputborder text-sm focus:outline-none"
        />
        <div
          *ngFor="let priority of filteredPriorities"
          class="px-3 py-2 text-sm text-theme-bodycolor dark:text-themedark-bodycolor
                 hover:bg-primary-100 dark:hover:bg-primary-900 cursor-pointer"
          (click)="selectPriority(priority); $event.stopPropagation()"
        >
          {{ priority.title }}
        </div>
        <div
          *ngIf="!filteredPriorities.length"
          class="px-3 py-2 text-sm text-theme-bodycolor dark:text-themedark-bodycolor"
        >
          {{ 'NoPrioritiesAvailable' | localize }}
        </div>
      </div>
    </div>
  </div>

  <!-- Status Dropdown -->
  <ng-container *ngIf="isEditing">
    <div class="grid grid-cols-3 items-center gap-4 mb-4">
      <label
        for="status"
        class="text-md font-medium text-theme-bodycolor dark:text-themedark-bodycolor"
      >
        {{ 'Field_Status' | localize }}
      </label>
      <div class="col-span-2 relative dropdown">
        <div
          class="dropdown-toggle w-full px-3 py-2 rounded-md border text-theme-bodycolor dark:text-themedark-bodycolor
                 bg-theme-inputbg dark:bg-themedark-inputbg transition focus:outline-none focus:ring-1
                 focus:ring-primary-500 border-theme-inputborder dark:border-themedark-inputborder
                 text-sm cursor-pointer flex justify-between items-center"
          [ngClass]="{'cursor-not-allowed': !isEditing}"
          (click)="toggleStatusDropdown(); $event.stopPropagation()"
        >
          <span>{{ selectedStatus?.title || ('SelectStatus' | localize) }}</span>
          <svg
            *ngIf="isEditing"
            class="w-4 h-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            ></path>
          </svg>
        </div>
        <input
          type="hidden"
          name="statusId"
          [(ngModel)]="issue.issueStatusId"
          #statusIdModel="ngModel"
          [required]="isEditing"
        />
        <abp-validation-summary
          class="text-red-500 mt-1 text-sm"
          [control]="statusIdModel"
        ></abp-validation-summary>
        <div
          *ngIf="isStatusDropdownOpen && isEditing"
          class="absolute left-0 top-full mt-1 w-full bg-theme-cardbg dark:bg-themedark-cardbg
                 border border-theme-inputborder dark:border-themedark-inputborder rounded-md shadow-lg
                 max-h-[50vh] overflow-y-auto scrollbar-thin scrollbar-thumb-primary-500
                 scrollbar-track-theme-inputbg dark:scrollbar-track-themedark-inputbg z-[1000]"
        >
          <input
            type="text"
            [(ngModel)]="statusSearch"
            (ngModelChange)="filterStatuses()"
            (click)="stopPropagation($event)"
            placeholder="{{ 'Search' | localize }}"
            class="w-full px-3 py-2 border-b text-theme-bodycolor dark:text-themedark-bodycolor
                   bg-theme-inputbg dark:bg-themedark-inputbg border-theme-inputborder
                   dark:border-themedark-inputborder text-sm focus:outline-none"
          />
          <div
            *ngFor="let status of filteredStatuses"
            class="px-3 py-2 text-sm text-theme-bodycolor dark:text-themedark-bodycolor
                   hover:bg-primary-100 dark:hover:bg-primary-900 cursor-pointer"
            (click)="selectStatus(status); $event.stopPropagation()"
          >
            {{ status.title }}
          </div>
          <div
            *ngIf="!filteredStatuses.length"
            class="px-3 py-2 text-sm text-theme-bodycolor dark:text-themedark-bodycolor"
          >
            {{ 'NoStatusesAvailable' | localize }}
          </div>
        </div>
      </div>
    </div>
  </ng-container>

  <!-- Deadline -->
  <div class="grid grid-cols-3 items-center gap-4 mb-4">
    <label
      for="deadline"
      class="text-md font-medium text-theme-bodycolor dark:text-themedark-bodycolor"
    >
      {{ 'Field_Deadline' | localize }}
    </label>
    <div class="col-span-2 relative">
      <input
        type="datetime-local"
        name="deadline"
        id="deadline"
        [(ngModel)]="deadlineFormatted"
        (ngModelChange)="onDeadlineChange($event)"
        #deadlineModel="ngModel"
        #deadlineEl
        class="w-full px-3 py-2 rounded-md border text-theme-bodycolor dark:text-themedark-bodycolor
               bg-theme-inputbg dark:bg-themedark-inputbg transition focus:outline-none focus:ring-1
               focus:ring-primary-500 border-theme-inputborder dark:border-themedark-inputborder
               text-sm appearance-none"
      />
      <abp-validation-summary
        class="text-red-500 mt-1 text-sm"
        [control]="deadlineModel"
        [controlEl]="deadlineEl"
      ></abp-validation-summary>
    </div>
  </div>

  <!-- Assignee Users Dropdown -->
  <div class="grid grid-cols-3 items-center gap-4 mb-4">
    <label
      for="assigneeUserIds"
      class="text-md font-medium text-theme-bodycolor dark:text-themedark-bodycolor"
    >
      {{ 'Field_Assignees' | localize }}
    </label>
    <div class="col-span-2 relative dropdown">
      <div
        class="dropdown-toggle w-full px-3 py-2 rounded-md border text-theme-bodycolor dark:text-themedark-bodycolor
               bg-theme-inputbg dark:bg-themedark-inputbg transition focus:outline-none focus:ring-1
               focus:ring-primary-500 border-theme-inputborder dark:border-themedark-inputborder
               text-sm cursor-pointer flex justify-between items-center"
        (click)="toggleAssigneeUsersDropdown(); $event.stopPropagation()"
      >
        <span>
          {{ getSelectedAssigneesDisplay() || ('SelectAssignees' | localize) }}
        </span>
        <svg
          class="w-4 h-4"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M19 9l-7 7-7-7"
          ></path>
        </svg>
      </div>
      <input
        type="hidden"
        name="assigneeUserIds"
        [(ngModel)]="issue.assigneeUserIds"
        #assigneeUserIdsModel="ngModel"
        required
      />
      <abp-validation-summary
        class="text-red-500 mt-1 text-sm"
        [control]="assigneeUserIdsModel"
      ></abp-validation-summary>
      <div
        *ngIf="isAssigneeUsersDropdownOpen"
        class="absolute left-0 top-full mt-1 w-full bg-theme-cardbg dark:bg-themedark-cardbg
               border border-theme-inputborder dark:border-themedark-inputborder rounded-md shadow-lg
               max-h-[50vh] overflow-y-auto scrollbar-thin scrollbar-thumb-primary-500
               scrollbar-track-theme-inputbg dark:scrollbar-track-themedark-inputbg z-[1000]"
      >
        <input
          type="text"
          [(ngModel)]="assigneeSearch"
          (ngModelChange)="filterAssignees()"
          (click)="stopPropagation($event)"
          placeholder="{{ 'Search' | localize }}"
          class="w-full px-3 py-2 border-b text-theme-bodycolor dark:text-themedark-bodycolor
                 bg-theme-inputbg dark:bg-themedark-inputbg border-theme-inputborder
                 dark:border-themedark-inputborder text-sm focus:outline-none"
        />
        <div
          *ngFor="let user of filteredAssignees"
          class="px-3 py-2 text-sm text-theme-bodycolor dark:text-themedark-bodycolor
                 hover:bg-primary-100 dark:hover:bg-primary-900 cursor-pointer flex items-center"
          [ngClass]="{'bg-primary-200 dark:bg-primary-800': isAssigneeSelected(user)}"
          (click)="toggleAssigneeSelection(user); $event.stopPropagation()"
        >
          <input
            type="checkbox"
            [checked]="isAssigneeSelected(user)"
            class="mr-2"
            (click)="stopPropagation($event)"
          />
          {{ user.number }}
        </div>
        <div
          *ngIf="!filteredAssignees.length"
          class="px-3 py-2 text-sm text-theme-bodycolor dark:text-themedark-bodycolor"
        >
          {{ 'NoUsersAvailable' | localize }}
        </div>
      </div>
    </div>
  </div>
</ng-container>