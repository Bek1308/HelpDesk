<div class="bg-theme-cardbg dark:bg-themedark-cardbg rounded-xl shadow-lg overflow-hidden border-l-4"
     [ngClass]="{
       'border-primary-500': issue.callCenterData,
       'border-green-500': issue.repairData,
       'border-purple-500': issue.techDepartmentData,
       'border-gray-500': !issue.callCenterData && !issue.repairData && !issue.techDepartmentData
     }">
  <div class="p-4 sm:p-6">
    <div class="flex items-center mb-2">
      <i class="fas fa-phone text-primary-500 text-base sm:text-lg mr-2" *ngIf="issue.callCenterData"></i>
      <i class="fas fa-wrench text-green-500 text-base sm:text-lg mr-2" *ngIf="issue.repairData"></i>
      <i class="fas fa-server text-purple-500 text-base sm:text-lg mr-2" *ngIf="issue.techDepartmentData"></i>
      <i class="fas fa-exclamation-circle text-gray-500 text-base sm:text-lg mr-2" *ngIf="!issue.callCenterData && !issue.repairData && !issue.techDepartmentData"></i>
      <h3 class="text-base sm:text-lg font-semibold text-gray-800 dark:text-gray-200 overflow-hidden text-ellipsis whitespace-nowrap">{{ issue.title }}</h3>
      <div class="ml-auto flex space-x-2">
        <span class="px-2 py-1 text-xs font-medium rounded-full"
              [ngClass]="{
                'bg-primary-100 text-primary-800 dark:bg-primary-900 dark:text-primary-200': issue.issueStatusName === 'Новый' || issue.issueStatusName === 'New' || issue.issueStatusName === 'Нав',
                'bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200': issue.issueStatusName === 'В процессе' || issue.issueStatusName === 'In Progress' || issue.issueStatusName === 'Дар раванд',
                'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200': issue.issueStatusName === 'Завершено' || issue.issueStatusName === 'Completed' || issue.issueStatusName === 'Анҷом ёфт'
              }">
          {{ issue.issueStatusName }}
        </span>
      </div>
    </div>
    <div class="border-b border-gray-200 dark:border-gray-700 mb-2">
      <nav class="flex space-x-4 sm:space-x-8" aria-label="Tabs">
        <button class="py-2 px-1 font-medium text-xs sm:text-sm transition-all duration-300 ease-in-out"
                [ngClass]="activeTab === 'main' ? 'border-b-2 border-primary-500 text-primary-600 dark:text-primary-300' : 'text-gray-600 dark:text-gray-400 border-b-2 border-transparent hover:border-gray-400'"
                (click)="setActiveTab('main')">{{ 'Main' | localize }}</button>
        <button class="py-2 px-1 font-medium text-xs sm:text-sm transition-all duration-300 ease-in-out"
                [ngClass]="activeTab === 'additional' ? 'border-b-2 border-primary-500 text-primary-600 dark:text-primary-300' : 'text-gray-600 dark:text-gray-400 border-b-2 border-transparent hover:border-gray-400'"
                (click)="setActiveTab('additional')">{{ 'Additional' | localize }}</button>
      </nav>
    </div>
    <div class="pt-2" [ngClass]="{'hidden': activeTab !== 'main'}">
      <p class="text-xs sm:text-sm text-gray-800 dark:text-gray-200 mb-2 overflow-hidden text-ellipsis" style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">{{ issue.description }}</p>
      <div class="flex justify-between items-center mb-2">
        <span class="text-xs text-gray-500 dark:text-gray-400">
          {{ issue.callCenterData ? ('PaymentIssue' | localize) : issue.repairData ? ('RepairIssue' | localize) : issue.techDepartmentData ? ('TechIssue' | localize) : ('StandardIssue' | localize) }}
        </span>
        <span class="px-2 py-1 text-xs font-medium rounded-full" [ngStyle]="{'background-color': priorityColor}">
          {{ issue.priorityName }}
        </span>
      </div>
      <div class="space-y-1 text-xs text-gray-500 dark:text-gray-400">
        <div class="flex justify-between">
          <span>{{ 'ReportedBy' | localize }}</span>
          <span>{{ issue.reportedByName || ('NotAvailable' | localize) }}</span>
        </div>
      </div>
    </div>
    <div class="pt-2 text-xs sm:text-sm text-gray-800 dark:text-gray-200" [ngClass]="{'hidden': activeTab !== 'additional'}">
      <ng-container *ngIf="issue.callCenterData; else noData">
        <p><strong>{{ 'Service' | localize }}:</strong> {{ issue.callCenterData.serviceName || ('NotAvailable' | localize) }}</p>
        <p><strong>{{ 'Sum' | localize }}:</strong> {{ issue.callCenterData.sum || ('NotAvailable' | localize) }}</p>
        <p><strong>{{ 'Subscriber' | localize }}:</strong> {{ issue.callCenterData.subscriber || ('NotAvailable' | localize) }}</p>
        <p><strong>{{ 'WrongNumber' | localize }}:</strong> {{ issue.callCenterData.wrongNumber || ('NotAvailable' | localize) }}</p>
        <p><strong>{{ 'RightNumber' | localize }}:</strong> {{ issue.callCenterData.rightNumber || ('NotAvailable' | localize) }}</p>
        <p><strong>{{ 'TerminalNumber' | localize }}:</strong> {{ issue.callCenterData.terminalNumber || ('NotAvailable' | localize) }}</p>
        <p><strong>{{ 'SubCategory' | localize }}:</strong> {{ issue.callCenterData.subCategoryName || ('NotAvailable' | localize) }}</p>
      </ng-container>
      <ng-container *ngIf="issue.repairData">
        <p><strong>{{ 'AgentFullName' | localize }}:</strong> {{ issue.repairData.agentFullName || ('NotAvailable' | localize) }}</p>
        <p><strong>{{ 'AgentNumber' | localize }}:</strong> {{ issue.repairData.agentNumber || ('NotAvailable' | localize) }}</p>
        <p><strong>{{ 'Equipment' | localize }}:</strong> {{ issue.repairData.equipment || ('NotAvailable' | localize) }}</p>
        <p><strong>{{ 'SerialNumber' | localize }}:</strong> {{ issue.repairData.serialNumber || ('NotAvailable' | localize) }}</p>
        <p><strong>{{ 'IssueDescription' | localize }}:</strong> {{ issue.repairData.issueDescription || ('NotAvailable' | localize) }}</p>
        <p><strong>{{ 'WorkAmount' | localize }}:</strong> {{ issue.repairData.workAmount || ('NotAvailable' | localize) }}</p>
        <p><strong>{{ 'ReplacementParts' | localize }}:</strong> {{ issue.repairData.replacementParts || ('NotAvailable' | localize) }}</p>
      </ng-container>
      <ng-container *ngIf="issue.techDepartmentData">
        <p><strong>{{ 'TerminalName' | localize }}:</strong> {{ issue.techDepartmentData.terminalName || ('NotAvailable' | localize) }}</p>
        <p><strong>{{ 'TerminalNumber' | localize }}:</strong> {{ issue.techDepartmentData.terminalNumber || ('NotAvailable' | localize) }}</p>
        <p><strong>{{ 'AgentNumber' | localize }}:</strong> {{ issue.techDepartmentData.agentNumber || ('NotAvailable' | localize) }}</p>
        <p><strong>{{ 'IssueDescription' | localize }}:</strong> {{ issue.techDepartmentData.issueDescription || ('NotAvailable' | localize) }}</p>
        <p><strong>{{ 'IssueGroupName' | localize }}:</strong> {{ issue.techDepartmentData.issueGroupName || ('NotAvailable' | localize) }}</p>
        <p><strong>{{ 'TerminalLocation' | localize }}:</strong> {{ issue.techDepartmentData.terminalLocation || ('NotAvailable' | localize) }}</p>
        <p><strong>{{ 'CityName' | localize }}:</strong> {{ issue.techDepartmentData.cityName || ('NotAvailable' | localize) }}</p>
      </ng-container>
      <ng-template #noData>
        <p *ngIf="!issue.repairData && !issue.techDepartmentData">{{ 'NoAdditionalData' | localize }}</p>
      </ng-template>
    </div>
    <div class="relative w-full mt-2">
      <div class="flex justify-between text-xs text-gray-500 dark:text-gray-400 mb-1">
        <span>{{ issue.creationTime | date:'dd.MM.yyyy' }}</span>
        <span class="font-medium text-red-600 dark:text-red-400">{{ issue.deadline | date:'dd.MM.yyyy' }}</span>
      </div>
      <div class="w-full h-1 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
        <div class="h-full rounded-full transition-all duration-300"
             [ngStyle]="{'width': progress + '%', 'background-color': progressColor}"></div>
      </div>
      <button class="w-full mt-2 text-white py-1 sm:py-2 rounded-lg transition-colors text-xs sm:text-sm"
              [ngClass]="{
                'bg-primary-600 hover:bg-primary-700': issue.callCenterData,
                'bg-green-600 hover:bg-green-700': issue.repairData,
                'bg-purple-600 hover:bg-purple-700': issue.techDepartmentData,
                'bg-gray-600 hover:bg-gray-700': !issue.callCenterData && !issue.repairData && !issue.techDepartmentData
              }"
              (click)="onActionClick()">
        <i class="fas fa-edit mr-1 sm:mr-2" *ngIf="issue.issueStatusName !== 'В процессе' && issue.issueStatusName !== 'In Progress' && issue.issueStatusName !== 'Дар раванд'"></i>
        <i class="fas fa-play mr-1 sm:mr-2" *ngIf="issue.issueStatusName === 'В процессе' || issue.issueStatusName === 'In Progress' || issue.issueStatusName === 'Дар раванд'"></i>
        {{ (issue.issueStatusName === 'В процессе' || issue.issueStatusName === 'In Progress' || issue.issueStatusName === 'Дар раванд') ? ('Continue' | localize) : ('Edit' | localize) }}
      </button>
    </div>
  </div>
</div>